<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Casos de Inovação Social | Observatório Social RJ</title>
    <meta name="description" content="Explore todos os casos de inovação social mapeados pelo Observatório do Rio de Janeiro - UFRJ.">
    <link rel="stylesheet" href="../css/main.css">
    <link rel="stylesheet" href="../css/components.css">
    <style>
        .casos-hero {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 100px 0 60px 0;
            margin-top: 70px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .casos-hero::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at 30% 40%, rgba(255,255,255,0.1) 0%, transparent 50%);
        }

        .casos-content {
            position: relative;
            z-index: 2;
        }

        .casos-hero h1 {
            font-size: 48px;
            font-weight: 700;
            margin-bottom: 20px;
        }

        .casos-hero p {
            font-size: 20px;
            opacity: 0.9;
            max-width: 600px;
            margin: 0 auto;
        }

        .casos-section {
            padding: 80px 0;
            background: white;
        }

        .filters-container {
            background: var(--background-light);
            padding: 40px;
            border-radius: var(--border-radius-lg);
            margin-bottom: 60px;
            box-shadow: var(--shadow-sm);
        }

        .filters-title {
            font-size: 20px;
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 30px;
            text-align: center;
        }

        .filters-row {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
            align-items: center;
        }

        .search-box {
            position: relative;
            width: 100%;
        }

        .search-icon {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 18px;
            color: var(--text-light);
        }

        .search-input {
            width: 100%;
            padding: 15px 15px 15px 45px;
            border: 2px solid var(--border-light);
            border-radius: var(--border-radius);
            font-size: 16px;
            background: white;
            transition: var(--transition);
        }

        .search-input:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 3px rgba(76, 139, 245, 0.1);
        }

        .filter-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            justify-content: center;
        }

        .filter-tag {
            padding: 8px 16px;
            border: 2px solid var(--border-light);
            background: white;
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: var(--transition);
            color: var(--text-dark);
        }

        .filter-tag:hover {
            border-color: var(--primary-color);
            transform: translateY(-2px);
        }

        .filter-tag.active {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 40px;
        }

        .results-count {
            font-size: 18px;
            color: var(--text-light);
        }

        .sort-options {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .sort-label {
            font-size: 14px;
            color: var(--text-light);
            margin-right: 10px;
        }

        .sort-select {
            padding: 8px 12px;
            border: 1px solid var(--border-light);
            border-radius: var(--border-radius);
            background: white;
            font-size: 14px;
        }

        .cases-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 30px;
            margin-bottom: 60px;
        }

        .case-card {
            background: white;
            border-radius: var(--border-radius-lg);
            padding: 30px;
            box-shadow: var(--shadow-md);
            border: 1px solid var(--border-light);
            transition: var(--transition);
            height: fit-content;
        }

        .case-card:hover {
            transform: translateY(-8px);
            box-shadow: var(--shadow-lg);
        }

        .case-card.category-education:hover {
            border-left: 4px solid #1565c0;
        }

        .case-card.category-health:hover {
            border-left: 4px solid #7b1fa2;
        }

        .case-card.category-environment:hover {
            border-left: 4px solid #2e7d32;
        }

        .case-card.category-social:hover {
            border-left: 4px solid #ef6c00;
        }

        .case-card.category-technology:hover {
            border-left: 4px solid #c2185b;
        }

        .case-card.category-economy:hover {
            border-left: 4px solid #558b2f;
        }

        .case-category-badge {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 15px;
        }

        .badge-education { background: #e3f2fd; color: #1565c0; }
        .badge-health { background: #f3e5f5; color: #7b1fa2; }
        .badge-environment { background: #e8f5e8; color: #2e7d32; }
        .badge-social { background: #fff3e0; color: #ef6c00; }
        .badge-technology { background: #fce4ec; color: #c2185b; }
        .badge-economy { background: #f1f8e9; color: #558b2f; }

        .case-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 12px;
            line-height: 1.3;
        }

        .case-meta {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-bottom: 15px;
            font-size: 14px;
            color: var(--text-light);
        }

        .case-meta span {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .case-description {
            color: var(--text-light);
            line-height: 1.6;
            margin-bottom: 20px;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .case-actions {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin-top: 40px;
        }

        .pagination button {
            padding: 10px 15px;
            border: 1px solid var(--border-light);
            background: white;
            color: var(--text-dark);
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: var(--transition);
        }

        .pagination button:hover:not(:disabled) {
            background: var(--primary-color);
            color: white;
        }

        .pagination button.active {
            background: var(--primary-color);
            color: white;
        }

        .pagination button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .empty-state {
            text-align: center;
            padding: 80px 20px;
            color: var(--text-light);
        }

        .empty-state-icon {
            font-size: 64px;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        @media (max-width: 768px) {
            .casos-hero h1 {
                font-size: 32px;
            }

            .filters-row {
                grid-template-columns: 1fr;
            }

            .results-header {
                flex-direction: column;
                gap: 20px;
                align-items: stretch;
            }

            .cases-grid {
                grid-template-columns: 1fr;
            }

            .case-actions {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <nav class="nav container">
            <a href="../index.html" class="logo">
                <span class="logo-main">Designário</span>
                <span class="logo-subtitle">OBSERVATÓRIO DE INOVAÇÃO SOCIAL</span>
            </a>
            
            <ul class="nav-links">
                <li><a href="../index.html">Início</a></li>
                <li><a href="casos.html" class="active">Casos</a></li>
                <li><a href="categorias.html">Categorias</a></li>
                <li><a href="sobre.html">Sobre</a></li>
                <li><a href="contato.html">Contato</a></li>
            </ul>

            <div class="nav-actions">
                <!-- Será atualizado dinamicamente pela função updateHeaderForAuth -->
                <a href="login.html" class="btn-secondary-header">Entrar</a>
                <a href="registro.html" class="btn-header">Criar Conta</a>
            </div>

            <button class="mobile-menu-btn" aria-label="Menu">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </nav>
    </header>

    <!-- Hero Section -->
    <section class="casos-hero">
        <div class="container">
            <div class="casos-content">
                <h1>Casos de Inovação Social</h1>
                <p>Descubra iniciativas transformadoras mapeadas em todo o Rio de Janeiro</p>
            </div>
        </div>
    </section>

    <!-- Cases Section -->
    <section class="casos-section">
        <div class="container">
            
            <!-- Filtros -->
            <div class="filters-container">
                <h3 class="filters-title">🔍 Encontre o caso ideal</h3>
                
                <div class="filters-row">
                    <div class="search-box">
                        <span class="search-icon">🔍</span>
                        <input type="text" class="search-input" placeholder="Buscar por nome, organização, região ou palavra-chave..." id="searchInput">
                    </div>
                    
                    <select class="form-select" id="regionFilter">
                        <option value="">Todas as Regiões</option>
                        <option value="Centro">Centro</option>
                        <option value="Zona Norte">Zona Norte</option>
                        <option value="Zona Sul">Zona Sul</option>
                        <option value="Zona Oeste">Zona Oeste</option>
                        <option value="Baixada">Baixada</option>
                    </select>
                    
                    <select class="form-select" id="statusFilter">
                        <option value="">Todos os Status</option>
                        <option value="Em andamento">Em Andamento</option>
                        <option value="Concluído">Concluído</option>
                        <option value="Pausado">Pausado</option>
                    </select>
                </div>
                
                <div class="filter-tags">
                    <button class="filter-tag" data-filter="categoria" data-value="Educação">Educação</button>
                    <button class="filter-tag" data-filter="categoria" data-value="Saúde">Saúde</button>
                    <button class="filter-tag" data-filter="categoria" data-value="Meio Ambiente">Meio Ambiente</button>
                    <button class="filter-tag" data-filter="categoria" data-value="Inclusão Social">Inclusão Social</button>
                    <button class="filter-tag" data-filter="categoria" data-value="Tecnologia Social">Tecnologia Social</button>
                    <button class="filter-tag" data-filter="categoria" data-value="Economia Solidária">Economia Solidária</button>
                </div>
            </div>

            <!-- Results Header -->
            <div class="results-header">
                <div class="results-count" id="resultsCount">
                    Carregando casos...
                </div>
                <div class="sort-options">
                    <span class="sort-label">Ordenar por:</span>
                    <select class="sort-select" id="sortSelect">
                        <option value="recent">Mais Recentes</option>
                        <option value="alphabetical">A-Z</option>
                        <option value="beneficiarios">Mais Beneficiários</option>
                        <option value="categoria">Categoria</option>
                    </select>
                </div>
            </div>
            
            <!-- Grid de Casos -->
            <div class="cases-grid" id="casesGrid">
                <!-- Os casos serão carregados dinamicamente via JavaScript -->
            </div>

            <!-- Paginação -->
            <div class="pagination" id="pagination" style="display: none;">
                <!-- Paginação será gerada dinamicamente -->
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h4>Observatório</h4>
                    <ul>
                        <li><a href="sobre.html">Sobre o Projeto</a></li>
                        <li><a href="#metodologia">Metodologia</a></li>
                        <li><a href="#equipe">Nossa Equipe</a></li>
                        <li><a href="#parceiros">Parceiros</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>Casos</h4>
                    <ul>
                        <li><a href="casos.html">Explorar Casos</a></li>
                        <li><a href="../index.html#categorias">Por Categoria</a></li>
                        <li><a href="#mapa">Mapa Interativo</a></li>
                        <li><a href="#relatorios">Relatórios</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>Participação</h4>
                    <ul>
                        <li><a href="cadastro.html">Cadastrar Caso</a></li>
                        <li><a href="#extensao">Programa de Extensão</a></li>
                        <li><a href="#voluntario">Seja Voluntário</a></li>
                        <li><a href="#newsletter">Newsletter</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>UFRJ</h4>
                    <ul>
                        <li><a href="https://ufrj.br" target="_blank" rel="noopener">Site Oficial</a></li>
                        <li><a href="https://extensao.ufrj.br" target="_blank" rel="noopener">Extensão UFRJ</a></li>
                        <li><a href="#pesquisa">Pesquisa</a></li>
                        <li><a href="contato.html">Contato</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2024 Observatório de Inovação Social do Rio de Janeiro - UFRJ. Todos os direitos reservados.</p>
            </div>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="../js/DataManager.js"></script>
    <script src="../js/AuthManager.js"></script>
    <script>
        // JavaScript específico da página de casos
        class CasosPage {
            constructor() {
                this.dataManager = DataManager.getInstance();
                this.authManager = AuthManager.getInstance();
                this.currentPage = 1;
                this.casesPerPage = 12;
                this.allCases = [];
                this.filteredCases = [];
                this.activeFilters = {
                    search: '',
                    categoria: '',
                    regiao: '',
                    status: ''
                };
                
                this.init();
            }

            async init() {
                // Aguardar carregamento dos dados
                await this.loadCases();
                this.setupEventListeners();
                this.authManager.updateUI();
                this.checkUrlParams();
            }

            async loadCases() {
                try {
                    this.allCases = this.dataManager.getCasos().filter(caso => caso.aprovado);
                    this.filteredCases = [...this.allCases];
                    this.renderCases();
                    this.updateResultsCount();
                } catch (error) {
                    console.error('Erro ao carregar casos:', error);
                    this.showError('Erro ao carregar casos. Tente novamente mais tarde.');
                }
            }

            checkUrlParams() {
                const urlParams = new URLSearchParams(window.location.search);
                const categoria = urlParams.get('categoria');
                
                if (categoria) {
                    this.activeFilters.categoria = categoria;
                    // Ativar filtro visual
                    const filterTag = document.querySelector(`[data-value="${categoria}"]`);
                    if (filterTag) {
                        filterTag.classList.add('active');
                    }
                    this.applyFilters();
                }
            }

            setupEventListeners() {
                // Busca por texto
                const searchInput = document.getElementById('searchInput');
                searchInput.addEventListener('input', this.debounce((e) => {
                    this.activeFilters.search = e.target.value;
                    this.applyFilters();
                }, 300));

                // Filtros de seleção
                document.getElementById('regionFilter').addEventListener('change', (e) => {
                    this.activeFilters.regiao = e.target.value;
                    this.applyFilters();
                });

                document.getElementById('statusFilter').addEventListener('change', (e) => {
                    this.activeFilters.status = e.target.value;
                    this.applyFilters();
                });

                // Tags de categoria
                document.querySelectorAll('.filter-tag').forEach(tag => {
                    tag.addEventListener('click', (e) => {
                        e.preventDefault();
                        tag.classList.toggle('active');
                        
                        if (tag.classList.contains('active')) {
                            this.activeFilters.categoria = tag.dataset.value;
                            // Desativar outras tags
                            document.querySelectorAll('.filter-tag').forEach(otherTag => {
                                if (otherTag !== tag) {
                                    otherTag.classList.remove('active');
                                }
                            });
                        } else {
                            this.activeFilters.categoria = '';
                        }
                        
                        this.applyFilters();
                    });
                });

                // Ordenação
                document.getElementById('sortSelect').addEventListener('change', (e) => {
                    this.sortCases(e.target.value);
                });
            }

            applyFilters() {
                this.filteredCases = this.allCases.filter(caso => {
                    // Filtro por texto
                    if (this.activeFilters.search) {
                        const searchTerm = this.activeFilters.search.toLowerCase();
                        const matchesSearch = 
                            caso.titulo.toLowerCase().includes(searchTerm) ||
                            caso.descricaoResumo.toLowerCase().includes(searchTerm) ||
                            caso.categoria.toLowerCase().includes(searchTerm) ||
                            caso.regiao.toLowerCase().includes(searchTerm) ||
                            caso.organizacao.toLowerCase().includes(searchTerm) ||
                            (caso.tags && caso.tags.some(tag => tag.toLowerCase().includes(searchTerm)));
                        
                        if (!matchesSearch) return false;
                    }

                    // Filtro por categoria
                    if (this.activeFilters.categoria && caso.categoria !== this.activeFilters.categoria) {
                        return false;
                    }

                    // Filtro por região
                    if (this.activeFilters.regiao && caso.regiao !== this.activeFilters.regiao) {
                        return false;
                    }

                    // Filtro por status
                    if (this.activeFilters.status && caso.status !== this.activeFilters.status) {
                        return false;
                    }

                    return true;
                });

                this.currentPage = 1;
                this.renderCases();
                this.updateResultsCount();
            }

            sortCases(sortBy) {
                switch (sortBy) {
                    case 'alphabetical':
                        this.filteredCases.sort((a, b) => a.titulo.localeCompare(b.titulo));
                        break;
                    case 'beneficiarios':
                        this.filteredCases.sort((a, b) => (b.beneficiarios || 0) - (a.beneficiarios || 0));
                        break;
                    case 'categoria':
                        this.filteredCases.sort((a, b) => a.categoria.localeCompare(b.categoria));
                        break;
                    case 'recent':
                    default:
                        this.filteredCases.sort((a, b) => new Date(b.dataCadastro) - new Date(a.dataCadastro));
                        break;
                }

                this.renderCases();
            }

            renderCases() {
                const container = document.getElementById('casesGrid');
                const startIndex = (this.currentPage - 1) * this.casesPerPage;
                const endIndex = startIndex + this.casesPerPage;
                const casesToShow = this.filteredCases.slice(startIndex, endIndex);

                if (casesToShow.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state" style="grid-column: 1 / -1;">
                            <div class="empty-state-icon">📄</div>
                            <h3>Nenhum caso encontrado</h3>
                            <p>Tente ajustar os filtros para encontrar casos correspondentes.</p>
                        </div>
                    `;
                    document.getElementById('pagination').style.display = 'none';
                    return;
                }

                container.innerHTML = casesToShow.map(caso => `
                    <div class="case-card category-${this.getCategorySlug(caso.categoria)}">
                        <span class="case-category-badge badge-${this.getCategorySlug(caso.categoria)}">${caso.categoria}</span>
                        <h3 class="case-title">${this.escapeHtml(caso.titulo)}</h3>
                        <div class="case-meta">
                            <span>📍 ${this.escapeHtml(caso.regiao)}</span>
                            <span>🏢 ${this.escapeHtml(caso.organizacao)}</span>
                            <span>👥 ${caso.beneficiarios} beneficiários</span>
                            <span>📅 ${this.formatDate(caso.dataCadastro)}</span>
                        </div>
                        <p class="case-description">${this.escapeHtml(caso.descricaoResumo)}</p>
                        <div class="case-actions">
                            <a href="caso.html?id=${caso.id}" class="btn-outline btn-small">Ver Detalhes</a>
                            <button class="btn-ghost btn-small" onclick="app.shareCaso(${caso.id})">Compartilhar</button>
                        </div>
                    </div>
                `).join('');

                this.renderPagination();
            }

            renderPagination() {
                const totalPages = Math.ceil(this.filteredCases.length / this.casesPerPage);
                const paginationContainer = document.getElementById('pagination');

                if (totalPages <= 1) {
                    paginationContainer.style.display = 'none';
                    return;
                }

                paginationContainer.style.display = 'flex';
                let paginationHTML = '';

                // Botão anterior
                paginationHTML += `
                    <button onclick="casosPage.goToPage(${this.currentPage - 1})" 
                            ${this.currentPage === 1 ? 'disabled' : ''}>
                        ← Anterior
                    </button>
                `;

                // Números das páginas
                for (let i = 1; i <= totalPages; i++) {
                    if (i === 1 || i === totalPages || (i >= this.currentPage - 1 && i <= this.currentPage + 1)) {
                        paginationHTML += `
                            <button onclick="casosPage.goToPage(${i})" 
                                    ${i === this.currentPage ? 'class="active"' : ''}>
                                ${i}
                            </button>
                        `;
                    } else if (i === this.currentPage - 2 || i === this.currentPage + 2) {
                        paginationHTML += '<span>...</span>';
                    }
                }

                // Botão próximo
                paginationHTML += `
                    <button onclick="casosPage.goToPage(${this.currentPage + 1})" 
                            ${this.currentPage === totalPages ? 'disabled' : ''}>
                        Próximo →
                    </button>
                `;

                paginationContainer.innerHTML = paginationHTML;
            }

            goToPage(page) {
                const totalPages = Math.ceil(this.filteredCases.length / this.casesPerPage);
                if (page < 1 || page > totalPages) return;

                this.currentPage = page;
                this.renderCases();
                
                // Scroll para o topo da seção
                document.getElementById('casesGrid').scrollIntoView({ 
                    behavior: 'smooth', 
                    block: 'start' 
                });
            }

            updateResultsCount() {
                const total = this.allCases.length;
                const filtered = this.filteredCases.length;
                const resultsElement = document.getElementById('resultsCount');

                if (filtered === total) {
                    resultsElement.textContent = `Exibindo todos os ${total} casos`;
                } else {
                    resultsElement.textContent = `Exibindo ${filtered} de ${total} casos`;
                }
            }

            // Utilitários
            getCategorySlug(categoria) {
                const slugs = {
                    'Educação': 'education',
                    'Saúde': 'health',
                    'Meio Ambiente': 'environment',
                    'Inclusão Social': 'social',
                    'Tecnologia Social': 'technology',
                    'Economia Solidária': 'economy'
                };
                return slugs[categoria] || 'social';
            }

            formatDate(dateString) {
                const date = new Date(dateString);
                return date.toLocaleDateString('pt-BR');
            }

            escapeHtml(text) {
                const map = {
                    '&': '&amp;',
                    '<': '&lt;',
                    '>': '&gt;',
                    '"': '&quot;',
                    "'": '&#039;'
                };
                return text.replace(/[&<>"']/g, function(m) { return map[m]; });
            }

            debounce(func, wait) {
                let timeout;
                return function executedFunction(...args) {
                    const later = () => {
                        clearTimeout(timeout);
                        func(...args);
                    };
                    clearTimeout(timeout);
                    timeout = setTimeout(later, wait);
                };
            }

            showError(message) {
                const container = document.getElementById('casesGrid');
                container.innerHTML = `
                    <div class="empty-state" style="grid-column: 1 / -1;">
                        <div class="empty-state-icon">⚠️</div>
                        <h3>Erro</h3>
                        <p>${message}</p>
                    </div>
                `;
            }
        }

        // Funcionalidade de compartilhamento global
        window.app = {
            shareCaso: function(casoId) {
                const dataManager = DataManager.getInstance();
                const caso = dataManager.getCasoById(casoId);
                
                if (caso) {
                    if (navigator.share) {
                        navigator.share({
                            title: caso.titulo,
                            text: caso.descricaoResumo,
                            url: `${window.location.origin}/pages/caso.html?id=${casoId}`
                        }).catch(err => {
                            console.log('Erro ao compartilhar:', err);
                        });
                    } else {
                        const url = `${window.location.origin}/pages/caso.html?id=${casoId}`;
                        navigator.clipboard.writeText(url).then(() => {
                            alert('Link copiado para a área de transferência!');
                        }).catch(err => {
                            console.error('Erro ao copiar para clipboard:', err);
                        });
                    }
                }
            }
        };

        // Inicializar página
        let casosPage;
        document.addEventListener('DOMContentLoaded', () => {
            casosPage = new CasosPage();
        });
    </script>
</body>
</html>
